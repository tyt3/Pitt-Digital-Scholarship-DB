{% extends 'base.html' %}
  {% block title %}{{ title }}{% endblock %}
  {% block content %}
    <br/>
    <div class="mx-auto col-12 col-md-12 col-lg-11">
        <h3>{{ person.first_name }} {{ person.last_name }}</h3>
        {% if person.photo_url %}
        <img style="margin: 10px 0 10px 0" 
        src="{{ person.photo_url }}">
        {% endif %}
        <br/>
        <strong>Pronouns:</strong> {{ person.pronouns }}<br/>
        <strong>Title:</strong> {{ person.title }}<br/>
        <strong>Unit:</strong>
        {% if person_unit|length > 1 %}
            <ul>
                {% for unit in person_unit %}
                <li>{{ unit }}
                    {% if user_can_update %}
                    &nbsp;
                    {% endif %}
                </li>
                {% endfor %}
            </ul>
        {% elif person_unit|length == 1 %}
            {{ person_unit[0] }}
            {% if user_can_update %}
            &nbsp;
            <a role="button" class="btn btn-outline-danger btn-sm"
            style="--bs-btn-padding-y: .05rem; --bs-btn-padding-x: .25rem; --bs-btn-font-size: .75rem; margin-bottom: 2.5px;"
            href="{{ url_for('views_bp.delete_person_unit', person_id=person.person_id, unit_name=person_unit[0])}}">Delete Unit</a>
            {% endif %}
        {% endif %}
        {% if user_can_update %}
            <br/>
            <button type="button" class="btn btn-outline-primary btn-sm"
                data-bs-toggle="modal" data-bs-target="#addUnitModal"
                style="-bs-btn-padding-y: .05rem; --bs-btn-padding-x: .25rem; --bs-btn-font-size: .75rem;margin: 5px 0 10px 0">
                Add a Unit
            </button>
        </form>
        {% endif %}
        <br/>
        <strong>Email:</strong> <a href="mailto:{{ person.email }}">{{ person.email }}</a><br/>
        {% if person.web_address %}
        <strong>Website:</strong> 
        <a href="{{ person.web_address }}" target="_blank">{{ person.web_address }}</a><br/>
        {% endif %}
        {% if person.phone %}
        <strong>Phone:</strong> 
        <a href="tel:{{ person.phone[0:3] }}-{{ person.phone[3:6] }}-{{ person.phone[6:10] }}">
            {{ person.phone[0:3] }}-{{ person.phone[3:6] }}-{{ person.phone[6:10] }}
        </a><br/>
        {% endif %}
        {% if person.scheduler_address %}
        <strong>Scheduler Address:</strong>
        <a href='{{ person.scheduler_address }}' target="_blank">
            {{ person.scheduler_address }}
        </a><br/>
        <strong>Preferred Contact Method:</strong> {{ person.preferred_contact }}<br/>
        <strong>Support Type:</strong> {{ person.support_type }}<br/>
        {% endif %}
        <strong>Affiliation:</strong> 
        {% if person_affiliation|length > 1 %}
            <ul>
                {% for a in person_affiliation %}
                <li>{{ a }}</li>
                {% endfor %}
            </ul>
        {% else %}
            {{ person_affiliation[0] }}
        {% endif %}
        {% if person.bio %}
        <strong>Bio:</strong> {{ person.bio }}<br/>
        {% endif %}
        {% if person.notes %}
        <strong>Notes:</strong> {{ person.notes }}<br/>
        {% endif %}
        {% if user_can_update %}
        <br/>
        <button type="button" class="btn btn-primary btn-sm"
        data-bs-toggle="modal" data-bs-target="#updatePersonModal">
        Update Person Information
        </button>
        {% endif %}
        <br/>
        <hr/>
        <h4>Areas of Support/Practice</h4>
        {% if person_support['areas']|length > 0 %}
        {% for area in person_support['areas'] %}
        <span style="font-size: 18px; font-weight: 500">{{ area }}</span> 
        {% if user_can_update %}
        &nbsp;
        <a role="button" class="btn btn-outline-primary btn-sm"
        style="--bs-btn-padding-y: .05rem; --bs-btn-padding-x: .25rem; --bs-btn-font-size: .75rem; margin-bottom: 5px;"
        href="{{ url_for('views_bp.update_area', area_name=area, public_id=person.public_id) }}">Update Area</a>
        {% endif %}
        <ul>
            <li><strong>Proficiency:</strong> {{ person_support['areas'][area]['proficiency'] }}</li>
            {% if person_support['areas'][area]['notes'] %}
            <li><strong>Notes:</strong> {{ person_support[area]['notes'] }}</li>
            {% endif %}
        </ul>
        {% endfor %}
        {% endif %}
        <br/>
        {% if user_can_update %}
        <button type="button" class="btn btn-primary btn-sm"
            data-bs-toggle="modal" data-bs-target="#addAreaModal">
            Add an Area
        </button>
        {% endif %}
        <br/>
        <hr/>
        <h4>Supported Methods</h4>
        {% if person_support['methods']|length > 0 %}
        {% for method in person_support['methods'] %}
        <span style="font-size: 18px; font-weight: 500">{{ method }}</span>
        {% if user_can_update %}
        &nbsp;
        <a role="button" class="btn btn-outline-primary btn-sm"
        style="--bs-btn-padding-y: .05rem; --bs-btn-padding-x: .25rem; --bs-btn-font-size: .75rem; margin-bottom: 5px;"
        href="{{ url_for('views_bp.update_area', area_name=area, public_id=person.public_id) }}">Update Method</a>
        {% endif %}
        <ul>
            <li><strong>Proficiency:</strong> {{ person_support['methods'][method]['proficiency'] }}</li>
            {% if person_support['methods'][method]['notes'] %}
            <li><strong>Notes:</strong><br/> {{ person_support['methods'][method]['notes'] }}</li>
            {% endif %}
        </ul>
        {% endfor %}
        {% endif %}
        <br/>
        {% if user_can_update %}
        <button type="button" class="btn btn-primary btn-sm"
            data-bs-toggle="modal" data-bs-target="#addMethodModal">
            Add a Method
        </button>
        {% endif %}
        <br/>
        <hr/>
        <h4>Supported Tools</h4>
        {% if person_support['tools']|length > 0 %}
        {% for tool in person_support['tools'] %}
        <span style="font-size: 18px; font-weight: 500">{{ tool }}</span>
        {% if user_can_update %}
        &nbsp;
        <a role="button" class="btn btn-outline-primary btn-sm"
        style="--bs-btn-padding-y: .05rem; --bs-btn-padding-x: .25rem; --bs-btn-font-size: .75rem; margin-bottom: 5px;"
        href="{{ url_for('views_bp.update_area', area_name=area, public_id=person.public_id) }}">Update Tool</a>
        {% endif %}
        <ul>
            <li><strong>Proficiency:</strong> {{ person_support['tools'][tool]['proficiency'] }}</li>
            {% if person_support['tools'][tool]['website'] %}
            <li><strong>Tool Website:</strong> 
                <a href="{{ person_support['tools'][tool]['website'] }}" 
                target="_blank">{{ person_support['tools'][tool]['website'] }}</a></li>
            {% endif %}
            {% if person_support['tools'][tool]['notes'] %}
            <li><strong>Notes:</strong> {{ person_support['tools'][tool]['notes'] }}</li>
            {% endif %}
        </ul>
        {% endfor %}
        {% endif %}
        {% if user_can_update %}
        <br/>
        <button type="button" class="btn btn-primary btn-sm"
            data-bs-toggle="modal" data-bs-target="#addToolModal">
            Add a Tool
        </button>
        {% endif %}
        <br/>
        </div>
        <br/>
        <!-- {% if user_can_update %}
        <div class="row">
            <div class="col">
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <button type="button" class="btn btn-primary btn-sm"
                    data-bs-toggle="modal" data-bs-target="#addAreaModal">
                    Add an Area
                    </button>
                </div>
            </div>
            <div class="col">
                <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                    <button type="button" class="btn btn-primary btn-sm"
                    data-bs-toggle="modal" data-bs-target="#addMethodModal">
                    Add a Method
                    </button>
                </div>
            </div>
            <div class="col">
                <div class="d-grid gap-2 d-md-flex justify-content-md-start">
                    <button type="button" class="btn btn-primary btn-sm"
                    data-bs-toggle="modal" data-bs-target="#addToolModal">
                    Add a Tool
                    </button>
                </div>
            </div>
        </div>
        <br/>
        {% endif %} -->

<!-- Update Person Form Modal -->
<div class="modal fade" id="updatePersonModal" name="updatePersonModal" 
tabindex="-1" aria-labelledby="updatePersonModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="updatePersonModalLabel">Update Person Record</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" 
          aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Person Form -->
          <div id="update_person_form">
            <form method="POST" action="{{ url_for('views_bp.add_person', public_id=person.public_id) }}" 
            target="_self">
              {% include "person-form.html" %}
            </form>
          </div>
          <br/>
        </div>
      </div>
    </div>
  </div>

<!-- Add Unit Form Modal -->
<div class="modal fade" id="addUnitModal" name="addUnitModal" 
tabindex="-1" aria-labelledby="addUnitModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5"
           id="addUnitModal">Add a Unit</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" 
          aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="add_unit_form">
            <form method="POST" action="{{ url_for('views_bp.add_person_unit', public_id=person.public_id) }}" 
                target="_self">
                <div class="form-group">
                    <label for="unit_name">Unit</label>
                    <select 
                        class="form-select form-select-md" aria-label=".form-select-md"
                        id="unit_name"
                        name="unit_name"
                        reqired>
                        <option value="" >Select a unit</option>
                        {% for unit in existing['all_units']  %}
                        <option value="{{ unit }}">{{ unit }}</option>
                        {% endfor %}
                    </select>
                    <small>Don't see your unit?  
                        <a href="{{ url_for('views_bp.add_unit') }}" target="_blank">
                            Add it to the database</a>!
                    </small>
                </div>
                <br/>
                <div class="form-group">
                    <label for="parent_unit_name">Parent Unit <small>(if any)</small></label>
                    <select 
                        class="form-select form-select-md" aria-label=".form-select-md"
                        id="parent_unit_name"
                        name="parent_unit_name"
                        required>
                        <option value="">Select a parent unit</option>
                        {% for unit in existing['units'] %}
                        <option value="{{ unit }}">{{ unit }}</option>
                        {% endfor %}
                        <option value="None">No parent unit</option>
                    </select>
                </div>
                <br/>
                <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                    <button type="submit" class="btn btn-primary">Submit</button>
                </div>
            </form>
            <br/>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- Add Area Form Modal -->
<div class="modal fade" id="addAreaModal" name="addAreaModal" 
tabindex="-1" aria-labelledby="addAreaModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5"
           id="addAreaModal">Add Area</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" 
          aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Person Form -->
          <div id="add_area_form">
            <form method="POST" action="{{ url_for('views_bp.add_area', public_id=person.public_id) }}" 
            target="_parent">
              {% include "add-area.html" %}
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- Add Method Form Modal -->
<div class="modal fade" id="addMethodModal" name="addMethodModal" 
tabindex="-1" aria-labelledby="addMethodModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5"
           id="addMethodModal">Add Method</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" 
          aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Person Form -->
          <div id="add_method_form">
            <form method="POST" action="{{ url_for('views_bp.add_method', public_id=person.public_id) }}" 
            target="_parent">
              {% include "add-method.html" %}
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- Add Tool Form Modal -->
<div class="modal fade" id="addToolModal" name="addToolModal" 
tabindex="-1" aria-labelledby="addToolModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5"
           id="addToolModal">Add Tool</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" 
          aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Person Form -->
          <div id="add_tool_form">
            <form method="POST" action="{{ url_for('views_bp.add_tool', public_id=person.public_id) }}" 
            target="_parent">
              {% include "add-tool.html" %}
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  


  <!-- Update Tool Form Modal -->
<div class="modal fade" id="updateToolModal" name="updateToolModal" 
tabindex="-1" aria-labelledby="updateToolModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5"
           id="updateToolModal">Update Tool</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" 
          aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Person Form -->
          <div id="update_tool_form">
            <form metod="POST" action="{{ url_for('views_bp.add_tool', public_id=person.public_id) }}" 
                target="updateToolModal">
              {% include "add-tool.html" %}
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Tool Form Modal -->
<div class="modal fade" id="deleteToolModal" name="deleteToolModal" 
tabindex="-1" aria-labelledby="deleteToolModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5"
           id="deleteToolModal">Delete Tool</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" 
          aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to delete this tool?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-danger">Delete</button>
        </div>
          <br/>
        </div>
      </div>
    </div>
  </div>
  {% endblock %}
